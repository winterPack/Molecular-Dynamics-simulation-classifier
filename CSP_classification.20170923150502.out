import numpy as np
import tensorflow as tf
import sys

tf.reset_default_graph()

# he initializer
he_init = tf.contrib.layers.variance_scaling_initializer(factor=1.0)
l2_reg = tf.contrib.layers.l2_regularizer(0.001)
# l2_reg = None

# make model
X = tf.placeholder(tf.float32,shape=[None,50,50,50,1])
y = tf.placeholder(tf.int32, shape=[None])

conv1 = tf.layers.conv3d(X,12,[5,5,5], padding='same', kernel_initializer=he_init, kernel_regularizer=l2_reg)
relu1 = tf.nn.elu(conv1)
maxpool1 = tf.layers.max_pooling3d(relu1, [4,4,4],[3,3,3])

conv2 = tf.layers.conv3d(maxpool1, 24, [5,5,5], padding='same', kernel_initializer=he_init, kernel_regularizer=l2_reg)
relu2 = tf.nn.elu(conv2)
maxpool2 = tf.layers.max_pooling3d(relu2, [4,4,4], [3,3,3])

n_layer = np.prod(maxpool2.shape[1:])._value
flat_layer = tf.reshape(maxpool2,shape=[-1,n_layer])

dense1 = tf.layers.dense(flat_layer, 1500, activation=tf.nn.elu, kernel_initializer=he_init, kernel_regularizer=l2_reg)
dense2 = tf.layers.dense(dense1, 1000, activation=tf.nn.elu, kernel_initializer=he_init, kernel_regularizer=l2_reg)
logits = tf.layers.dense(dense2,19,kernel_initializer=he_init)

# loss function
loss = tf.nn.sparse_softmax_cross_entropy_with_logits(logits=logits, labels=y)
optimizer = tf.train.AdamOptimizer(learning_rate = 0.001)
train_op = optimizer.minimize(loss)

# accuracy evaluation
correct_predictions = tf.nn.in_top_k(logits, y, 1)
accuracy = tf.reduce_mean(tf.cast(correct_predictions,tf.float32))

# load data
from csp_tools import *
X_train, y_train = load_data_range(range(19),range(40))
X_val, y_val = load_data_range(range(19),range(40,45))

# setup run
maxEpoch = 100
batchSize =20
n = X_train.shape[0]
nBatch = n//batchSize
saver_path = './CSP.epoch_{}.ckpt'

saver = tf.train.Saver()
init = tf.global_variables_initializer()
with tf.Session() as sess:        
    init.run()
    for epoch in range(maxEpoch):
            idx = np.random.permutation(n)
            b_idx = np.array_split(idx,nBatch)
            batch_acc = []
            for b in b_idx:
                    X_batch, y_batch = X_train[b], y_train[b]
                    X_batch = random_roll(X_batch) #random circular shift
                    acc,_ = sess.run([accuracy,train_op], feed_dict={X: X_batch, y: y_batch})
                    batch_acc.append(acc)
                    print('    batch_acc = {}'.format(acc))
                    sys.stdout.flush()
            train_acc = np.mean(batch_acc)
            print('epoch {}, train_acc {}'.format(epoch, train_acc))
            if epoch%1==0:
                    # train_acc = accuracy.eval(feed_dict={X: X_train, y: y_train})
                    val_acc = accuracy.eval(feed_dict={X: X_val, y: y_val})
                    print('train_acc {}, val_acc {}'.format(train_acc, val_acc))
                    saver.save(sess, saver_path.format(epoch))
    batch_acc = 0.05000000074505806
    batch_acc = 0.0
    batch_acc = 0.05000000074505806
    batch_acc = 0.05000000074505806
    batch_acc = 0.10000000149011612
    batch_acc = 0.10000000149011612
    batch_acc = 0.0
    batch_acc = 0.0
    batch_acc = 0.0
    batch_acc = 0.15000000596046448
    batch_acc = 0.10000000149011612
    batch_acc = 0.05000000074505806
    batch_acc = 0.05000000074505806
    batch_acc = 0.0
    batch_acc = 0.05000000074505806
    batch_acc = 0.0
    batch_acc = 0.0
    batch_acc = 0.10000000149011612
    batch_acc = 0.05000000074505806
    batch_acc = 0.05000000074505806
    batch_acc = 0.05000000074505806
    batch_acc = 0.0
    batch_acc = 0.05000000074505806
    batch_acc = 0.05000000074505806
    batch_acc = 0.0
    batch_acc = 0.05000000074505806
    batch_acc = 0.05000000074505806
    batch_acc = 0.10000000149011612
    batch_acc = 0.05000000074505806
    batch_acc = 0.05000000074505806
    batch_acc = 0.05000000074505806
    batch_acc = 0.0
    batch_acc = 0.10000000149011612
    batch_acc = 0.10000000149011612
    batch_acc = 0.10000000149011612
    batch_acc = 0.10000000149011612
    batch_acc = 0.20000000298023224
    batch_acc = 0.15000000596046448
epoch 0, train_acc 0.0578947439789772
train_acc 0.0578947439789772, val_acc 0.11578947305679321
    batch_acc = 0.15000000596046448
    batch_acc = 0.05000000074505806
    batch_acc = 0.10000000149011612
    batch_acc = 0.3499999940395355
    batch_acc = 0.05000000074505806
    batch_acc = 0.05000000074505806
    batch_acc = 0.15000000596046448
    batch_acc = 0.10000000149011612
    batch_acc = 0.15000000596046448
    batch_acc = 0.05000000074505806
    batch_acc = 0.10000000149011612
    batch_acc = 0.10000000149011612
    batch_acc = 0.25
    batch_acc = 0.15000000596046448
    batch_acc = 0.05000000074505806
    batch_acc = 0.20000000298023224
    batch_acc = 0.05000000074505806
    batch_acc = 0.10000000149011612
    batch_acc = 0.15000000596046448
    batch_acc = 0.05000000074505806
    batch_acc = 0.15000000596046448
    batch_acc = 0.20000000298023224
    batch_acc = 0.15000000596046448
    batch_acc = 0.15000000596046448
    batch_acc = 0.05000000074505806
    batch_acc = 0.15000000596046448
    batch_acc = 0.05000000074505806
    batch_acc = 0.10000000149011612
    batch_acc = 0.20000000298023224
    batch_acc = 0.05000000074505806
    batch_acc = 0.30000001192092896
    batch_acc = 0.05000000074505806
    batch_acc = 0.05000000074505806
    batch_acc = 0.20000000298023224
    batch_acc = 0.10000000149011612
    batch_acc = 0.10000000149011612
    batch_acc = 0.05000000074505806
    batch_acc = 0.10000000149011612
epoch 1, train_acc 0.12105263024568558
train_acc 0.12105263024568558, val_acc 0.1473684161901474
    batch_acc = 0.05000000074505806
    batch_acc = 0.10000000149011612
    batch_acc = 0.0
    batch_acc = 0.10000000149011612
    batch_acc = 0.25
    batch_acc = 0.05000000074505806
    batch_acc = 0.20000000298023224
    batch_acc = 0.05000000074505806
    batch_acc = 0.25
    batch_acc = 0.10000000149011612
    batch_acc = 0.20000000298023224
    batch_acc = 0.10000000149011612
    batch_acc = 0.25
    batch_acc = 0.20000000298023224
    batch_acc = 0.10000000149011612
    batch_acc = 0.20000000298023224
    batch_acc = 0.05000000074505806
    batch_acc = 0.05000000074505806
    batch_acc = 0.25
    batch_acc = 0.05000000074505806
    batch_acc = 0.25
    batch_acc = 0.05000000074505806
    batch_acc = 0.05000000074505806
    batch_acc = 0.10000000149011612
    batch_acc = 0.15000000596046448
    batch_acc = 0.10000000149011612
    batch_acc = 0.10000000149011612
    batch_acc = 0.15000000596046448
    batch_acc = 0.05000000074505806
    batch_acc = 0.15000000596046448
    batch_acc = 0.25
    batch_acc = 0.05000000074505806
    batch_acc = 0.30000001192092896
    batch_acc = 0.15000000596046448
    batch_acc = 0.25
    batch_acc = 0.25
    batch_acc = 0.25
    batch_acc = 0.25
epoch 2, train_acc 0.1447368562221527
train_acc 0.1447368562221527, val_acc 0.1894736886024475
    batch_acc = 0.20000000298023224
    batch_acc = 0.05000000074505806
    batch_acc = 0.15000000596046448
    batch_acc = 0.30000001192092896
    batch_acc = 0.0
    batch_acc = 0.20000000298023224
    batch_acc = 0.30000001192092896
    batch_acc = 0.25
    batch_acc = 0.20000000298023224
    batch_acc = 0.30000001192092896
    batch_acc = 0.4000000059604645
    batch_acc = 0.3499999940395355
    batch_acc = 0.30000001192092896
    batch_acc = 0.25
    batch_acc = 0.25
    batch_acc = 0.4000000059604645
    batch_acc = 0.15000000596046448
    batch_acc = 0.15000000596046448
    batch_acc = 0.4000000059604645
    batch_acc = 0.10000000149011612
    batch_acc = 0.25
    batch_acc = 0.30000001192092896
    batch_acc = 0.20000000298023224
    batch_acc = 0.3499999940395355
    batch_acc = 0.3499999940395355
    batch_acc = 0.10000000149011612
    batch_acc = 0.25
    batch_acc = 0.25
    batch_acc = 0.15000000596046448
    batch_acc = 0.20000000298023224
    batch_acc = 0.05000000074505806
    batch_acc = 0.15000000596046448
    batch_acc = 0.20000000298023224
    batch_acc = 0.10000000149011612
    batch_acc = 0.15000000596046448
    batch_acc = 0.10000000149011612
    batch_acc = 0.20000000298023224
    batch_acc = 0.15000000596046448
epoch 3, train_acc 0.21578946709632874
train_acc 0.21578946709632874, val_acc 0.21052631735801697
    batch_acc = 0.20000000298023224
    batch_acc = 0.25
    batch_acc = 0.20000000298023224
    batch_acc = 0.10000000149011612
    batch_acc = 0.15000000596046448
    batch_acc = 0.25
    batch_acc = 0.05000000074505806
    batch_acc = 0.25
    batch_acc = 0.25
    batch_acc = 0.15000000596046448
    batch_acc = 0.15000000596046448
    batch_acc = 0.05000000074505806
    batch_acc = 0.20000000298023224
    batch_acc = 0.25
    batch_acc = 0.25
    batch_acc = 0.4000000059604645
    batch_acc = 0.30000001192092896
    batch_acc = 0.3499999940395355
    batch_acc = 0.15000000596046448
    batch_acc = 0.30000001192092896
    batch_acc = 0.3499999940395355
    batch_acc = 0.20000000298023224
    batch_acc = 0.30000001192092896
    batch_acc = 0.25
    batch_acc = 0.20000000298023224
    batch_acc = 0.15000000596046448
    batch_acc = 0.30000001192092896
    batch_acc = 0.25
    batch_acc = 0.30000001192092896
    batch_acc = 0.20000000298023224
    batch_acc = 0.0
    batch_acc = 0.30000001192092896
    batch_acc = 0.25
    batch_acc = 0.25
    batch_acc = 0.30000001192092896
    batch_acc = 0.30000001192092896
    batch_acc = 0.30000001192092896
    batch_acc = 0.15000000596046448
epoch 4, train_acc 0.22631579637527466
train_acc 0.22631579637527466, val_acc 0.3263157904148102
    batch_acc = 0.4000000059604645
    batch_acc = 0.20000000298023224
    batch_acc = 0.25
    batch_acc = 0.25
    batch_acc = 0.4000000059604645
    batch_acc = 0.3499999940395355
    batch_acc = 0.10000000149011612
    batch_acc = 0.3499999940395355
    batch_acc = 0.25
    batch_acc = 0.20000000298023224
    batch_acc = 0.3499999940395355
    batch_acc = 0.20000000298023224
    batch_acc = 0.20000000298023224
    batch_acc = 0.44999998807907104
    batch_acc = 0.5
    batch_acc = 0.4000000059604645
    batch_acc = 0.30000001192092896
    batch_acc = 0.30000001192092896
    batch_acc = 0.44999998807907104
    batch_acc = 0.3499999940395355
    batch_acc = 0.25
    batch_acc = 0.20000000298023224
    batch_acc = 0.4000000059604645
    batch_acc = 0.3499999940395355
    batch_acc = 0.15000000596046448
    batch_acc = 0.44999998807907104
    batch_acc = 0.550000011920929
    batch_acc = 0.3499999940395355
    batch_acc = 0.4000000059604645
    batch_acc = 0.550000011920929
    batch_acc = 0.10000000149011612
    batch_acc = 0.6000000238418579
    batch_acc = 0.3499999940395355
    batch_acc = 0.3499999940395355
    batch_acc = 0.4000000059604645
    batch_acc = 0.4000000059604645
    batch_acc = 0.4000000059604645
    batch_acc = 0.3499999940395355
epoch 5, train_acc 0.33815789222717285
train_acc 0.33815789222717285, val_acc 0.410526305437088
    batch_acc = 0.550000011920929
    batch_acc = 0.44999998807907104
    batch_acc = 0.6499999761581421
    batch_acc = 0.30000001192092896
    batch_acc = 0.44999998807907104
    batch_acc = 0.44999998807907104
    batch_acc = 0.3499999940395355
    batch_acc = 0.3499999940395355
    batch_acc = 0.30000001192092896
    batch_acc = 0.4000000059604645
    batch_acc = 0.30000001192092896
    batch_acc = 0.5
    batch_acc = 0.25
    batch_acc = 0.3499999940395355
    batch_acc = 0.3499999940395355
    batch_acc = 0.3499999940395355
    batch_acc = 0.5
    batch_acc = 0.25
    batch_acc = 0.30000001192092896
    batch_acc = 0.5
    batch_acc = 0.5
    batch_acc = 0.20000000298023224
    batch_acc = 0.20000000298023224
    batch_acc = 0.44999998807907104
    batch_acc = 0.4000000059604645
    batch_acc = 0.25
    batch_acc = 0.4000000059604645
    batch_acc = 0.30000001192092896
    batch_acc = 0.20000000298023224
    batch_acc = 0.4000000059604645
    batch_acc = 0.3499999940395355
    batch_acc = 0.30000001192092896
    batch_acc = 0.4000000059604645
    batch_acc = 0.20000000298023224
    batch_acc = 0.44999998807907104
    batch_acc = 0.6000000238418579
    batch_acc = 0.4000000059604645
    batch_acc = 0.25
epoch 6, train_acc 0.3723684251308441
train_acc 0.3723684251308441, val_acc 0.31578946113586426
    batch_acc = 0.25
    batch_acc = 0.550000011920929
    batch_acc = 0.4000000059604645
    batch_acc = 0.6000000238418579
    batch_acc = 0.44999998807907104
    batch_acc = 0.6499999761581421
    batch_acc = 0.6000000238418579
    batch_acc = 0.30000001192092896
    batch_acc = 0.30000001192092896
    batch_acc = 0.25
    batch_acc = 0.3499999940395355
    batch_acc = 0.4000000059604645
    batch_acc = 0.44999998807907104
    batch_acc = 0.6000000238418579
    batch_acc = 0.5
    batch_acc = 0.550000011920929
    batch_acc = 0.3499999940395355
    batch_acc = 0.20000000298023224
    batch_acc = 0.30000001192092896
    batch_acc = 0.20000000298023224
    batch_acc = 0.3499999940395355
    batch_acc = 0.3499999940395355
    batch_acc = 0.4000000059604645
    batch_acc = 0.4000000059604645
    batch_acc = 0.44999998807907104
    batch_acc = 0.5
    batch_acc = 0.3499999940395355
    batch_acc = 0.699999988079071
    batch_acc = 0.3499999940395355
    batch_acc = 0.4000000059604645
    batch_acc = 0.550000011920929
    batch_acc = 0.30000001192092896
    batch_acc = 0.550000011920929
    batch_acc = 0.550000011920929
    batch_acc = 0.25
    batch_acc = 0.44999998807907104
    batch_acc = 0.3499999940395355
    batch_acc = 0.4000000059604645
epoch 7, train_acc 0.41842105984687805
train_acc 0.41842105984687805, val_acc 0.34736841917037964
    batch_acc = 0.30000001192092896
    batch_acc = 0.6000000238418579
    batch_acc = 0.30000001192092896
    batch_acc = 0.25
    batch_acc = 0.6000000238418579
    batch_acc = 0.3499999940395355
    batch_acc = 0.550000011920929
    batch_acc = 0.30000001192092896
    batch_acc = 0.6499999761581421
    batch_acc = 0.550000011920929
    batch_acc = 0.30000001192092896
    batch_acc = 0.5
    batch_acc = 0.4000000059604645
    batch_acc = 0.4000000059604645
    batch_acc = 0.44999998807907104
    batch_acc = 0.30000001192092896
    batch_acc = 0.6000000238418579
    batch_acc = 0.5
    batch_acc = 0.44999998807907104
    batch_acc = 0.4000000059604645
    batch_acc = 0.6000000238418579
    batch_acc = 0.4000000059604645
    batch_acc = 0.3499999940395355
    batch_acc = 0.25
    batch_acc = 0.3499999940395355
    batch_acc = 0.5
    batch_acc = 0.3499999940395355
    batch_acc = 0.4000000059604645
    batch_acc = 0.550000011920929
    batch_acc = 0.6000000238418579
    batch_acc = 0.3499999940395355
    batch_acc = 0.30000001192092896
    batch_acc = 0.550000011920929
    batch_acc = 0.5
    batch_acc = 0.5
    batch_acc = 0.25
    batch_acc = 0.5
    batch_acc = 0.3499999940395355
epoch 8, train_acc 0.43157893419265747
train_acc 0.43157893419265747, val_acc 0.4736842215061188
    batch_acc = 0.6000000238418579
    batch_acc = 0.6000000238418579
    batch_acc = 0.44999998807907104
    batch_acc = 0.4000000059604645
    batch_acc = 0.699999988079071
    batch_acc = 0.20000000298023224
    batch_acc = 0.15000000596046448
    batch_acc = 0.6000000238418579
    batch_acc = 0.550000011920929
    batch_acc = 0.44999998807907104
    batch_acc = 0.4000000059604645
    batch_acc = 0.4000000059604645
    batch_acc = 0.3499999940395355
    batch_acc = 0.4000000059604645
    batch_acc = 0.5
    batch_acc = 0.20000000298023224
    batch_acc = 0.550000011920929
    batch_acc = 0.3499999940395355
    batch_acc = 0.44999998807907104
    batch_acc = 0.5
    batch_acc = 0.44999998807907104
    batch_acc = 0.25
    batch_acc = 0.5
    batch_acc = 0.5
    batch_acc = 0.6000000238418579
    batch_acc = 0.6000000238418579
    batch_acc = 0.550000011920929
    batch_acc = 0.6499999761581421
    batch_acc = 0.5
    batch_acc = 0.699999988079071
    batch_acc = 0.699999988079071
    batch_acc = 0.6499999761581421
    batch_acc = 0.75
    batch_acc = 0.699999988079071
    batch_acc = 0.5
    batch_acc = 0.550000011920929
    batch_acc = 0.550000011920929
    batch_acc = 0.699999988079071
epoch 9, train_acc 0.5052631497383118
train_acc 0.5052631497383118, val_acc 0.5894736647605896
    batch_acc = 0.5
    batch_acc = 0.699999988079071
    batch_acc = 0.6499999761581421
    batch_acc = 0.6000000238418579
    batch_acc = 0.44999998807907104
    batch_acc = 0.6000000238418579
    batch_acc = 0.30000001192092896
    batch_acc = 0.550000011920929
    batch_acc = 0.6499999761581421
    batch_acc = 0.6499999761581421
    batch_acc = 0.44999998807907104
    batch_acc = 0.550000011920929
    batch_acc = 0.44999998807907104
    batch_acc = 0.5
    batch_acc = 0.6000000238418579
    batch_acc = 0.550000011920929
    batch_acc = 0.5
    batch_acc = 0.550000011920929
    batch_acc = 0.5
    batch_acc = 0.75
    batch_acc = 0.6000000238418579
    batch_acc = 0.5
    batch_acc = 0.4000000059604645
    batch_acc = 0.550000011920929
    batch_acc = 0.44999998807907104
    batch_acc = 0.6000000238418579
    batch_acc = 0.20000000298023224
    batch_acc = 0.44999998807907104
    batch_acc = 0.6499999761581421
    batch_acc = 0.6499999761581421
    batch_acc = 0.6000000238418579
    batch_acc = 0.44999998807907104
    batch_acc = 0.4000000059604645
    batch_acc = 0.6499999761581421
    batch_acc = 0.6000000238418579
    batch_acc = 0.699999988079071
    batch_acc = 0.550000011920929
    batch_acc = 0.6499999761581421
epoch 10, train_acc 0.5447368025779724
train_acc 0.5447368025779724, val_acc 0.6105263233184814
    batch_acc = 0.6499999761581421
    batch_acc = 0.75
    batch_acc = 0.550000011920929
    batch_acc = 0.550000011920929
    batch_acc = 0.44999998807907104
    batch_acc = 0.6000000238418579
    batch_acc = 0.550000011920929
    batch_acc = 0.6499999761581421
    batch_acc = 0.6000000238418579
    batch_acc = 0.75
    batch_acc = 0.44999998807907104
    batch_acc = 0.550000011920929
    batch_acc = 0.4000000059604645
    batch_acc = 0.75
    batch_acc = 0.800000011920929
    batch_acc = 0.550000011920929
    batch_acc = 0.550000011920929
    batch_acc = 0.75
    batch_acc = 0.4000000059604645
    batch_acc = 0.6000000238418579
    batch_acc = 0.6000000238418579
    batch_acc = 0.550000011920929
    batch_acc = 0.5
    batch_acc = 0.75
    batch_acc = 0.6000000238418579
    batch_acc = 0.5
    batch_acc = 0.4000000059604645
    batch_acc = 0.6000000238418579
    batch_acc = 0.44999998807907104
    batch_acc = 0.75
    batch_acc = 0.6499999761581421
    batch_acc = 0.550000011920929
    batch_acc = 0.75
    batch_acc = 0.5
    batch_acc = 0.75
    batch_acc = 0.699999988079071
    batch_acc = 0.6000000238418579
    batch_acc = 0.5
epoch 11, train_acc 0.5947368741035461
train_acc 0.5947368741035461, val_acc 0.5894736647605896
    batch_acc = 0.6499999761581421
    batch_acc = 0.6499999761581421
    batch_acc = 0.6000000238418579
    batch_acc = 0.6499999761581421
    batch_acc = 0.6499999761581421
    batch_acc = 0.6000000238418579
    batch_acc = 0.5
    batch_acc = 0.6499999761581421
    batch_acc = 0.75
    batch_acc = 0.800000011920929
    batch_acc = 0.75
    batch_acc = 0.699999988079071
    batch_acc = 0.6499999761581421
    batch_acc = 0.550000011920929
    batch_acc = 0.6499999761581421
    batch_acc = 0.800000011920929
    batch_acc = 0.75
    batch_acc = 0.5
    batch_acc = 0.699999988079071
    batch_acc = 0.75
    batch_acc = 0.6000000238418579
    batch_acc = 0.6000000238418579
    batch_acc = 0.550000011920929
    batch_acc = 0.699999988079071
    batch_acc = 0.699999988079071
    batch_acc = 0.44999998807907104
    batch_acc = 0.75
    batch_acc = 0.3499999940395355
    batch_acc = 0.6499999761581421
    batch_acc = 0.550000011920929
    batch_acc = 0.44999998807907104
    batch_acc = 0.75
    batch_acc = 0.550000011920929
    batch_acc = 0.550000011920929
    batch_acc = 0.550000011920929
    batch_acc = 0.4000000059604645
    batch_acc = 0.6000000238418579
    batch_acc = 0.6000000238418579
epoch 12, train_acc 0.6223683953285217
train_acc 0.6223683953285217, val_acc 0.5789473652839661
    batch_acc = 0.550000011920929
    batch_acc = 0.75
    batch_acc = 0.75
    batch_acc = 0.800000011920929
    batch_acc = 0.699999988079071
    batch_acc = 0.6000000238418579
    batch_acc = 0.5
    batch_acc = 0.6000000238418579
    batch_acc = 0.699999988079071
    batch_acc = 0.699999988079071
    batch_acc = 0.699999988079071
    batch_acc = 0.800000011920929
    batch_acc = 0.44999998807907104
    batch_acc = 0.5
    batch_acc = 0.800000011920929
    batch_acc = 0.75
    batch_acc = 0.699999988079071
    batch_acc = 0.75
    batch_acc = 0.6000000238418579
    batch_acc = 0.75
    batch_acc = 0.699999988079071
    batch_acc = 0.5
    batch_acc = 0.6000000238418579
    batch_acc = 0.699999988079071
    batch_acc = 0.6000000238418579
    batch_acc = 0.4000000059604645
    batch_acc = 0.44999998807907104
    batch_acc = 0.6000000238418579
    batch_acc = 0.6000000238418579
    batch_acc = 0.6000000238418579
    batch_acc = 0.6499999761581421
    batch_acc = 0.6000000238418579
    batch_acc = 0.44999998807907104
    batch_acc = 0.6000000238418579
    batch_acc = 0.699999988079071
    batch_acc = 0.699999988079071
    batch_acc = 0.75
    batch_acc = 0.800000011920929
epoch 13, train_acc 0.6434211134910583
train_acc 0.6434211134910583, val_acc 0.7052631378173828
    batch_acc = 0.699999988079071
    batch_acc = 0.699999988079071
    batch_acc = 0.800000011920929
    batch_acc = 0.6000000238418579
    batch_acc = 0.75
    batch_acc = 0.550000011920929
    batch_acc = 0.699999988079071
    batch_acc = 0.44999998807907104
    batch_acc = 0.6000000238418579
    batch_acc = 0.6499999761581421
    batch_acc = 0.699999988079071
    batch_acc = 0.800000011920929
    batch_acc = 0.699999988079071
    batch_acc = 0.699999988079071
    batch_acc = 0.6000000238418579
    batch_acc = 0.550000011920929
    batch_acc = 0.6000000238418579
    batch_acc = 0.550000011920929
    batch_acc = 0.699999988079071
    batch_acc = 0.550000011920929
    batch_acc = 0.4000000059604645
    batch_acc = 0.550000011920929
    batch_acc = 0.75
    batch_acc = 0.6499999761581421
    batch_acc = 0.6499999761581421
    batch_acc = 0.550000011920929
    batch_acc = 0.30000001192092896
    batch_acc = 0.44999998807907104
    batch_acc = 0.6499999761581421
    batch_acc = 0.3499999940395355
    batch_acc = 0.550000011920929
    batch_acc = 0.6000000238418579
    batch_acc = 0.44999998807907104
    batch_acc = 0.25
    batch_acc = 0.6499999761581421
    batch_acc = 0.4000000059604645
    batch_acc = 0.5
    batch_acc = 0.6000000238418579
epoch 14, train_acc 0.5855262875556946
train_acc 0.5855262875556946, val_acc 0.6105263233184814
    batch_acc = 0.699999988079071
    batch_acc = 0.699999988079071
    batch_acc = 0.5
    batch_acc = 0.550000011920929
    batch_acc = 0.550000011920929
    batch_acc = 0.3499999940395355
    batch_acc = 0.5
    batch_acc = 0.44999998807907104
    batch_acc = 0.6499999761581421
    batch_acc = 0.6000000238418579
    batch_acc = 0.8500000238418579
    batch_acc = 0.6000000238418579
    batch_acc = 0.6499999761581421
    batch_acc = 0.5
    batch_acc = 0.550000011920929
    batch_acc = 0.550000011920929
    batch_acc = 0.4000000059604645
    batch_acc = 0.44999998807907104
    batch_acc = 0.699999988079071
    batch_acc = 0.6000000238418579
    batch_acc = 0.6499999761581421
    batch_acc = 0.550000011920929
    batch_acc = 0.6000000238418579
    batch_acc = 0.6499999761581421
    batch_acc = 0.6000000238418579
    batch_acc = 0.44999998807907104
    batch_acc = 0.699999988079071
    batch_acc = 0.6000000238418579
    batch_acc = 0.800000011920929
    batch_acc = 0.699999988079071
    batch_acc = 0.699999988079071
    batch_acc = 0.8500000238418579
    batch_acc = 0.6000000238418579
    batch_acc = 0.6000000238418579
    batch_acc = 0.6499999761581421
    batch_acc = 0.699999988079071
    batch_acc = 0.6000000238418579
    batch_acc = 0.8500000238418579
epoch 15, train_acc 0.611842155456543
train_acc 0.611842155456543, val_acc 0.75789475440979
    batch_acc = 0.8999999761581421
    batch_acc = 0.6499999761581421
    batch_acc = 0.699999988079071
    batch_acc = 0.699999988079071
    batch_acc = 0.550000011920929
    batch_acc = 0.6000000238418579
    batch_acc = 0.699999988079071
    batch_acc = 0.8500000238418579
    batch_acc = 0.8500000238418579
    batch_acc = 0.6000000238418579
    batch_acc = 0.8999999761581421
    batch_acc = 0.6499999761581421
    batch_acc = 0.75
    batch_acc = 0.550000011920929
    batch_acc = 0.550000011920929
    batch_acc = 0.75
    batch_acc = 0.699999988079071
    batch_acc = 0.75
    batch_acc = 0.550000011920929
    batch_acc = 0.699999988079071
    batch_acc = 0.75
    batch_acc = 0.8999999761581421
    batch_acc = 0.6000000238418579
    batch_acc = 0.6000000238418579
    batch_acc = 0.800000011920929
    batch_acc = 0.6499999761581421
    batch_acc = 0.8500000238418579
    batch_acc = 0.6499999761581421
    batch_acc = 0.8500000238418579
    batch_acc = 0.699999988079071
    batch_acc = 0.699999988079071
    batch_acc = 0.8500000238418579
    batch_acc = 0.800000011920929
    batch_acc = 0.800000011920929
    batch_acc = 0.8500000238418579
    batch_acc = 0.8500000238418579
    batch_acc = 0.75
    batch_acc = 0.800000011920929
epoch 16, train_acc 0.7289474010467529
train_acc 0.7289474010467529, val_acc 0.7789473533630371
    batch_acc = 0.8999999761581421
    batch_acc = 0.75
    batch_acc = 0.699999988079071
    batch_acc = 0.75
    batch_acc = 0.75
    batch_acc = 0.550000011920929
    batch_acc = 0.8500000238418579
    batch_acc = 0.699999988079071
    batch_acc = 0.550000011920929
    batch_acc = 0.699999988079071
    batch_acc = 0.699999988079071
    batch_acc = 0.6000000238418579
    batch_acc = 0.6000000238418579
    batch_acc = 0.75
    batch_acc = 0.6000000238418579
    batch_acc = 0.75
    batch_acc = 0.6499999761581421
    batch_acc = 0.75
    batch_acc = 0.6000000238418579
    batch_acc = 0.75
    batch_acc = 0.6000000238418579
    batch_acc = 0.6499999761581421
    batch_acc = 0.699999988079071
    batch_acc = 0.8999999761581421
    batch_acc = 0.699999988079071
    batch_acc = 0.75
    batch_acc = 0.800000011920929
    batch_acc = 0.5
    batch_acc = 0.75
    batch_acc = 0.75
    batch_acc = 0.44999998807907104
    batch_acc = 0.6499999761581421
    batch_acc = 0.699999988079071
    batch_acc = 0.5
    batch_acc = 0.5
    batch_acc = 0.44999998807907104
    batch_acc = 0.5
    batch_acc = 0.6000000238418579
epoch 17, train_acc 0.6684210896492004
train_acc 0.6684210896492004, val_acc 0.621052622795105
    batch_acc = 0.44999998807907104
    batch_acc = 0.75
    batch_acc = 0.4000000059604645
    batch_acc = 0.699999988079071
    batch_acc = 0.699999988079071
    batch_acc = 0.5
    batch_acc = 0.4000000059604645
    batch_acc = 0.699999988079071
    batch_acc = 0.6000000238418579
    batch_acc = 0.699999988079071
    batch_acc = 0.699999988079071
    batch_acc = 0.699999988079071
    batch_acc = 0.6000000238418579
    batch_acc = 0.550000011920929
    batch_acc = 0.6000000238418579
    batch_acc = 0.75
    batch_acc = 0.699999988079071
    batch_acc = 0.800000011920929
    batch_acc = 0.800000011920929
    batch_acc = 0.75
    batch_acc = 0.699999988079071
    batch_acc = 0.699999988079071
    batch_acc = 0.5
    batch_acc = 0.8500000238418579
    batch_acc = 0.699999988079071
    batch_acc = 0.699999988079071
    batch_acc = 0.75
    batch_acc = 0.550000011920929
    batch_acc = 0.6000000238418579
    batch_acc = 0.800000011920929
    batch_acc = 0.6000000238418579
    batch_acc = 0.75
    batch_acc = 0.75
    batch_acc = 0.699999988079071
    batch_acc = 0.6000000238418579
    batch_acc = 0.8999999761581421
    batch_acc = 0.6000000238418579
    batch_acc = 0.800000011920929
epoch 18, train_acc 0.6684210300445557
train_acc 0.6684210300445557, val_acc 0.7052631378173828
    batch_acc = 0.6499999761581421
    batch_acc = 0.8500000238418579
    batch_acc = 0.75
    batch_acc = 0.4000000059604645
    batch_acc = 0.550000011920929
    batch_acc = 0.699999988079071
    batch_acc = 0.6000000238418579
    batch_acc = 0.6499999761581421
    batch_acc = 0.6499999761581421
    batch_acc = 0.550000011920929
    batch_acc = 0.5
    batch_acc = 0.5
    batch_acc = 0.699999988079071
    batch_acc = 0.6499999761581421
    batch_acc = 0.75
    batch_acc = 0.6499999761581421
    batch_acc = 0.6000000238418579
    batch_acc = 0.800000011920929
    batch_acc = 0.5
    batch_acc = 0.699999988079071
    batch_acc = 0.6000000238418579
    batch_acc = 0.699999988079071
    batch_acc = 0.699999988079071
    batch_acc = 0.5
    batch_acc = 0.550000011920929
    batch_acc = 0.699999988079071
    batch_acc = 0.4000000059604645
    batch_acc = 0.5
    batch_acc = 0.75
    batch_acc = 0.6499999761581421
    batch_acc = 0.3499999940395355
    batch_acc = 0.5
    batch_acc = 0.75
    batch_acc = 0.6000000238418579
    batch_acc = 0.5
    batch_acc = 0.5
    batch_acc = 0.44999998807907104
    batch_acc = 0.550000011920929
epoch 19, train_acc 0.6039474010467529
train_acc 0.6039474010467529, val_acc 0.6421052813529968
    batch_acc = 0.6499999761581421
    batch_acc = 0.800000011920929
    batch_acc = 0.6000000238418579
    batch_acc = 0.75
    batch_acc = 0.6499999761581421
    batch_acc = 0.550000011920929
    batch_acc = 0.75
    batch_acc = 0.800000011920929
    batch_acc = 0.550000011920929
